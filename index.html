<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Meine Lieblingsrezepte – Cover & Inhaltsverzeichnis</title>

  <style>
    /* ========== Design-Variablen (Pastell) ========== */
    :root{
      --beige:#F6F1E7;
      --text:#2b2b2b;
      --muted:#7b7b7b;
      --border:#e4dccb;

      --gelb:#FFF6BF;        /* Frühstück */
      --mint:#CFF5E7;        /* Hauptspeisen */
      --rosa:#FFD3E2;        /* Bakery */
      --orange:#FFD8B1;      /* Snacks & Desserts */
      --blau:#CFE9FF;        /* Drinks */

      --link:#3a6ea5;
      --link-hover:#214e7c;

      --shadow: 0 6px 18px rgba(0,0,0,.06);
      --radius: 18px;
      --radius-sm: 12px;
      --maxw: 700px;     /* Tablet */
      --iphone-w: 430px; /* iPhone Breite */
    }

    /* ========== Reset + Typo ========== */
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text);
      background:#ffffff;
      line-height:1.55;
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }

    /* iPhone-optimierte Mittelspalte */
    .page{
      margin:0 auto;
      width:100%;
      max-width:var(--iphone-w);
    }

    /* ========== Inhaltsverzeichnis ========== */
    .toc.beige{
      background: var(--beige);
      padding: 28px 14px 110px; /* Platz für Quickjump */
    }
    .toc .wrap{
      background:#fff;
      border:1.5px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:20px 14px;
    }
    .toc h2{
      margin:0 0 14px;
      font-size: clamp(22px, 5.2vw, 28px);
      text-align:center;
    }
    .divider{
      height:1px;background:#eee;margin:18px 0;
    }
    .cat{
      border-radius: var(--radius);
      padding:14px;
      margin: 12px 0 18px;
      border:1px solid #eee;
    }
    .cat.gelb   { background: var(--gelb); }
    .cat.mint   { background: var(--mint); }
    .cat.rosa   { background: var(--rosa); }
    .cat.orange { background: var(--orange); }
    .cat.blau   { background: var(--blau); }

    .cat > h3{
      margin:0 0 8px;
      font-size: clamp(18px, 4.6vw, 22px);
    }
    .cat h4{
      margin:14px 0 4px;
      font-size: 15px;
      opacity:.9;
    }

    ul{list-style:none;margin:6px 0 10px;padding:0}
    .cat > ul > li{margin:0;}
    .cat ul li a{
      display:block;
      padding:10px 12px;
      margin: 6px 0;
      background:#ffffffc9;
      border:1px solid #ffffff;
      border-radius: var(--radius-sm);
      text-decoration:none;
      color:var(--text);
      transition: transform .06s ease, box-shadow .2s ease, background .2s ease;
      box-shadow: 0 1px 0 rgba(0,0,0,.02);
    }
    /* Override: Rezeptlinks in den (Unter-)kategorien dezenter */
.cat ul li a{
  font-size: 14px;
  padding: 8px 10px;
  margin: 5px 0;
}
    .cat ul li a:hover{
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(0,0,0,.08);
      background:#fff;
    }

    .cat h4 + ul{
      border-left: 3px solid rgba(0,0,0,.08);
      margin-left: 6px;
      padding-left: 10px;
    }

    .pill{
      display:inline-block;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid #e7e7e7;
      background:#fff;
      text-decoration:none;
      color:var(--text);
      margin: 4px 6px 0 0;
    }

    .quickjump{
      position: fixed;
      right: 14px;
      bottom: 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 50;
    }
    .quickjump a{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      background:#fff;
      border:1px solid var(--border);
      border-radius: 12px;
      text-decoration:none;
      color:var(--text);
      font-size: 13px;
      box-shadow: var(--shadow);
      transition: transform .06s ease, box-shadow .2s ease;
    }
    .quickjump a:hover{
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(0,0,0,.1);
    }

    .space{height:16px}
    .note{
      color:var(--muted);
      font-size:12px;
      text-align:center;
      margin-top:6px;
    }

    html{scroll-behavior:smooth}
    .quickjump{ padding-bottom: env(safe-area-inset-bottom, 0); }
    .toc.beige{ padding-bottom: calc(110px + env(safe-area-inset-bottom, 0)); }
  </style>

  <style>
/* Grundkarte */
section.recipe{
  background:#fff;
  border:1.5px solid var(--border);
  border-radius: 18px;
  box-shadow: var(--shadow);
  padding:16px 14px 12px;
  margin: 18px 12px;
}

/* farbige Hintergründe + Akzente je Hauptkategorie */
section.recipe.fruehstueck {
  background:#FFFAE6;            /* sanftes Gelb */
  border-color:#e6db95;
  box-shadow: 0 6px 18px rgba(230,219,149,.25);
}
section.recipe.hauptspeisen{
  background:#F2FBF7;            /* sanftes Mint */
  border-color:#8fdac7;
  box-shadow: 0 6px 18px rgba(143,218,199,.25);
}
section.recipe.bakery{
  background:#FFF0F6;            /* sanftes Rosa */
  border-color:#ff99cc;
  box-shadow: 0 6px 18px rgba(255,153,204,.25);
}
section.recipe.snacks{
  background:#FFF3E3;            /* sanftes Orange */
  border-color:#ffb266;
  box-shadow: 0 6px 18px rgba(255,178,102,.25);
}
section.recipe.drinks{
  background:#F0F8FF;            /* sanftes Blau */
  border-color:#99cfff;
  box-shadow: 0 6px 18px rgba(153,207,255,.25);
}
    /* Hover-Lift für Rezeptkarten */
section.recipe{
  transition: transform .12s ease, box-shadow .2s ease;
  will-change: transform;
}
section.recipe:hover{
  transform: translateY(-4px);
  box-shadow: 0 12px 26px rgba(0,0,0,.12);
}

/* Weniger Bewegung für Nutzer mit Motion-Reduktion */
@media (prefers-reduced-motion: reduce){
  section.recipe{ transition: box-shadow .2s ease; }
  section.recipe:hover{ transform: none; }
}

/* kleine Header-Underline im Akzentton */
section.recipe.fruehstueck h3{ border-bottom:2px solid #FFF6BF; padding-bottom:4px; }
section.recipe.hauptspeisen h3{ border-bottom:2px solid #CFF5E7; padding-bottom:4px; }
section.recipe.bakery h3{ border-bottom:2px solid #FFD3E2; padding-bottom:4px; }
section.recipe.snacks h3{ border-bottom:2px solid #FFD8B1; padding-bottom:4px; }
section.recipe.drinks h3{ border-bottom:2px solid #CFE9FF; padding-bottom:4px; }

/* Zutaten-/Schritte-Listen hübsch */
section.recipe .zutaten ul{ margin:8px 0 0; padding-left: 18px; list-style: disc; }
section.recipe .zubereitung ol{ margin:8px 0 0; padding-left: 18px; }
section.recipe .meta{ font-size: .95rem; color: var(--muted); }
section.recipe .meta input[type=number]{ margin-left:6px; }
</style>
  
</head>
<body>

<!-- =========================
     ➕ Rezept hinzufügen (Modal)
========================== -->
<style>
  .add-btn {
    position: fixed; top: 14px; left: 14px; z-index: 1000;
    display: inline-flex; align-items: center; gap: 8px;
    padding: 10px 12px; border-radius: 12px;
    background:#fff; border:1px solid #ddd; box-shadow: 0 6px 16px rgba(0,0,0,.08);
    color:#222; text-decoration: none; font-size: 14px;
  }
  .add-btn:hover { transform: translateY(-1px); box-shadow: 0 10px 22px rgba(0,0,0,.1); }

  .modal-backdrop{ position: fixed; inset:0; background: rgba(0,0,0,.25);
    display:none; align-items:center; justify-content:center; z-index: 1001; }
  .modal { width: min(720px, 92vw); background:#fff; border:1.5px solid #eee;
    border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.12); padding: 16px 16px 4px; }
  .modal h3{ margin: 2px 0 10px; }
  .modal .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
  .modal .grid-1{ display:grid; grid-template-columns: 1fr; gap:12px; }
  .modal label{ font-size: 12px; color: #666; display:block; margin-bottom:4px; }
  .modal input[type="text"], .modal input[type="number"], .modal select, .modal textarea{
    width:100%; padding:10px 12px; border:1.5px solid #e5e5e5; border-radius:12px; font-size:14px;
    outline:none; background:#fff;
  }
  .modal textarea{ min-height:120px; resize: vertical; }
  .modal .actions{ display:flex; gap:10px; justify-content:flex-end; padding: 10px 0 6px; }
  .btn{ padding:10px 12px; border-radius:10px; border:1px solid #ddd; background:#f8f8f8; cursor:pointer; }
  .btn.primary{ background:#2f6fed; border-color:#2a61d0; color:#fff; }
  .btn:disabled{ opacity:.6; cursor:not-allowed; }
</style>

<a class="add-btn" href="#" id="openAddRecipe">➕ Rezept</a>

<div class="modal-backdrop" id="addRecipeModal">
  <form class="modal" id="recipeForm">
    <h3>Neues Rezept hinzufügen</h3>

    <div class="grid">
      <div>
        <label for="title">Name des Rezepts</label>
        <input id="title" type="text" required placeholder="z. B. Tomatenrisotto">
      </div>
      <div>
        <label for="servings">Portionen</label>
        <input id="servings" type="number" min="1" value="4" required>
      </div>
      <div>
        <label for="prep">Zubereitungszeit (z. B. 20 Min)</label>
        <input id="prep" type="text" required>
      </div>
      <div>
        <label for="total">Gesamtzeit (z. B. 45 Min)</label>
        <input id="total" type="text" required>
      </div>
      <div>
        <label for="category">Hauptkategorie</label>
        <select id="category" required></select>
      </div>
      <div>
        <label for="subcategory">Unterkategorie (falls vorhanden)</label>
        <select id="subcategory" disabled></select>
      </div>
    </div>

    <div class="grid-1" style="margin-top:12px">
      <div>
        <label for="ingredients">Zutaten (eine pro Zeile – mit Menge am Anfang, z. B. "250 g Mehl")</label>
        <textarea id="ingredients" placeholder="250 g Mehl&#10;1 TL Salz&#10;..."></textarea>
      </div>
      <div>
        <label for="steps">Zubereitung (Schritte; jede Zeile wird ein Schritt)</label>
        <textarea id="steps" placeholder="Zwiebel würfeln...&#10;Anschwitzen..."></textarea>
      </div>
    </div>

    <div class="actions">
      <button type="button" class="btn" id="cancelAdd">Abbrechen</button>
      <button type="submit" class="btn primary">Speichern</button>
    </div>
  </form>
</div>


  
  
<script>
/* ===== Alphabetisch einfügen (TOC + Content) & TOC-Finder ===== */
;(function(){
  const norm = s => (s||'')
    .toLowerCase()
    .normalize('NFD')
    .replace(/\p{Diacritic}/gu,'')
    .replace(/[^\p{Letter}\p{Number}]+/gu,' ')
    .trim();
  window.normalizeKey = norm;

  const catRoot = (cat)=>{
    const map = {
      'Frühstück':'#fruehstueck',
      'Hauptspeise':'#hauptspeisen',
      'Bakery':'#bakery',
      'Snacks & Desserts':'#snacks',
      'Drinks':'#drinks'
    };
    return document.querySelector(map[cat]||null);
  };

  window.getTocList = function(cat, sub){
    const root = catRoot(cat);
    if(!root) return document.querySelector('.cat ul');
    if(!sub)  return root.querySelector('.cat ul');
    const h4 = Array.from(root.querySelectorAll('h4')).find(el => norm(el.textContent).includes(norm(sub)));
    if(!h4){ return root.querySelector('.cat ul'); }
    let el = h4.nextElementSibling;
    while(el && el.tagName !== 'UL') el = el.nextElementSibling;
    return el || root.querySelector('.cat ul');
  };

  window.insertSortedTOC = function(ul, li){
    const key = norm(li.textContent);
    const items = Array.from(ul.children).filter(x=>x.tagName==='LI');
    const at = items.find(el => norm(el.textContent) > key);
    if (at) ul.insertBefore(li, at); else ul.appendChild(li);
  };

  window.insertSortedSection = function({section, cat, sub}){
  const norm = s => (s||'')
    .toLowerCase()
    .normalize('NFD')
    .replace(/\p{Diacritic}/gu,'')
    .trim();

  // Anker (Cover) bestimmen – Subcat > Cat > Fallback
  const mapCoverId = (cat, sub) => {
    const sc = (window.CANON?.[cat]?.subcats?.[sub]) || null;
    if (sc?.coverId) return sc.coverId;
    const cc = window.CANON?.[cat]?.coverId;
    if (cc) return cc;
    const hard = {
      'Frühstück':'fruehstueck-cover',
      'Hauptspeise':'hauptspeisen-cover',
      'Bakery':'bakery-cover',
      'Snacks & Desserts':'snacks-cover',
      'Drinks':'drinks-cover'
    }[cat];
    return hard || 'cover';
  };

  const t = (typeof resolveTargets === 'function') ? resolveTargets(cat, sub) : {};
  const cover =
    t?.contentAnchor ||
    document.getElementById(mapCoverId(cat, sub)) ||
    document.getElementById('cover') ||
    document.body;

  // In richtige (cat, sub)-Gruppe alphabetisch einsortieren
  const all = Array.from(document.querySelectorAll('section.recipe'))
    .filter(s => s !== section
      && ((s.dataset.category||'') === (cat||''))
      && ((s.dataset.subcategory||'') === (sub||'')));

  const key = norm(section.querySelector('h2')?.textContent);
  const before = all.find(s => norm(s.querySelector('h2')?.textContent) > key);

  if (before) before.parentNode.insertBefore(section, before);
  else cover.insertAdjacentElement('afterend', section);
};
     
  window.sortExistingTOCLists = function(){
    document.querySelectorAll('.cat ul').forEach(ul=>{
      const items = Array.from(ul.children).filter(li=>li.tagName==='LI');
      items.sort((a,b)=>norm(a.textContent).localeCompare(norm(b.textContent)));
      items.forEach(li=>ul.appendChild(li));
    });
  };
})();
</script>

  

<script>
/* ========= KANONISCHE BEZEICHNUNGEN + Ziele (eine Quelle der Wahrheit) ========= */
(function(){
  // 1) Zentrale Definition: Kategorien, Unterkategorien, Cover-IDs und TOC-Ziele
  const CANON = {
    "Frühstück": {
      coverId: "fruehstueck-cover",
      tocRoot: "#fruehstueck",
      subcats: {
        "Brot & Aufstriche": { coverId: "brot-und-aufstriche-cover" },
        "Sonstiges":         { coverId: "fruehstueck-sonstiges-cover" }
      }
    },
    "Hauptspeise": {
      coverId: "hauptspeisen-cover",
      tocRoot: "#hauptspeisen",
      subcats: {
        "Burger, Wraps & Bowls": { coverId: "burger-wraps-und-bowls-cover" },  tocList: "#haupt-burger-wraps-bowls-list" },
        "Vegetarische Gerichte": { coverId: "vegetarische-gerichte-cover" },  tocList: "#haupt-vegetarisch-list" },
        "Suppen & Eintöpfe":             { coverId: "suppen-und-eintoepfe-cover" }, tocList: "#haupt-suppen-list" },
        "Pasta & Nudeln":                { coverId: "pasta-und-nudeln-cover" },
        "Pizza":                         { coverId: "pizza-cover" },
        "Reis & Getreidegerichte":       { coverId: "reis-und-getreide-cover" },
        "Internationale Küche & Currys": { coverId: "internationale-kueche-und-currys-cover" },
        // Einheitlich: **Beilagen** (Plural) überall
        "Snacks, Beilagen & Fingerfood": { coverId: "snacks-beilagen-und-fingerfood-cover" },
        "Basics & Saucen":               { coverId: "basics-und-saucen-cover" },
        "Curry-Pasten":                  { coverId: "curry-pasten-cover" }
      }
    },
    "Bakery": {
      coverId: "bakery-cover",
      tocRoot: "#bakery",
      subcats: {
        "Kuchen & Torten":         { coverId: "kuchen-und-torten-cover" },
        "Plätzchen & Kleingebäck": { coverId: "plätzchen-und-kleingebäck-cover" },
        "Sonstiges Gebäck":        { coverId: "sonstiges-gebäck-cover" }
      }
    },
    "Snacks & Desserts": {
      coverId: "snacks-cover",
      tocRoot: "#snacks",
      subcats: { }
    },
    "Drinks": {
      coverId: "drinks-cover",
      tocRoot: "#drinks",
      // Drinks hat spezielle TOC-Listen je Subcat
      subcats: {
        "Alkoholische Getränke":       { coverId: "alkoholische-getraenke-cover", tocList: "#drinks-alkoholische-list" },
        "Nicht-alkoholische Getränke": { coverId: "alkoholfreie-getraenke-cover", tocList: "#drinks-nicht-alkoholische-list" }
      }
    }
  };

  // 2) Exponiere die kanonische Struktur (falls später nützlich)
  window.CANON = CANON;

  // 3) Erzeuge window.CATS **automatisch** aus CANON (für das Formular)
  window.CATS = Object.fromEntries(
    Object.entries(CANON).map(([cat, cfg]) => [cat, Object.keys(cfg.subcats || {})])
  );

  // 4) Einheitliche Hilfsfunktionen
  const pick = sel => sel ? document.querySelector(sel) : null;
  const q = (root, sel) => root ? root.querySelector(sel) : null;

  // 5) resolveTargets generieren – nutzt ausschließlich CANON
  window.resolveTargets = function(cat, subcat){
    const catCfg = CANON[cat] || null;

    // Fallback-Guessing für alte/abweichende Daten
    const guessId =
      cat === 'Frühstück' ? 'fruehstueck' :
      (cat||'').toLowerCase().includes('haupt') ? 'hauptspeisen' :
      (cat||'').toLowerCase().includes('snacks') ? 'snacks' :
      (cat||'').toLowerCase();

    // Content-Anker (Cover der Subcat, sonst Cover der Cat, sonst globaler Fallback)
    const subCfg = catCfg?.subcats?.[subcat] || null;
    const contentAnchor =
      (subCfg && pick('#' + subCfg.coverId)) ||
      (catCfg && pick('#' + catCfg.coverId)) ||
      pick('#' + guessId + '-cover') ||
      document.body;

    // TOC-Liste:
    // - Drinks: spezielle UL pro Subcat (wenn definiert)
    // - Alle anderen: die erste UL im Cat-Block bzw. generischer Fallback
    let tocList = null;
    if (catCfg) {
      if (subCfg?.tocList) {
        tocList = pick(subCfg.tocList);
      }
      if (!tocList) {
        const root = pick(catCfg.tocRoot);
        tocList = q(root, 'ul') || pick('#' + guessId + ' ul');
      }
    }
    tocList = tocList || document.querySelector('.cat ul');

    return { tocList, contentAnchor };
  };

  // 6) Optional: Prüfer, der Inkonsistenzen in der Konsole ausgibt
  window.assertCanonicalLabels = function(){
    const problems = [];
    // Prüfe, ob alle Subcat-Cover im DOM vorhanden sind
    for (const [cat, cfg] of Object.entries(CANON)) {
      for (const [sub, sc] of Object.entries(cfg.subcats || {})) {
        if (!document.getElementById(sc.coverId)) {
          problems.push(`Fehlendes Cover im DOM: [${cat} > ${sub}] -> id="${sc.coverId}"`);
        }
      }
    }
    // Kurzer Report
    if (problems.length) {
      console.warn('⚠️ Canon-Check: Inkonsistenzen gefunden:\n- ' + problems.join('\n- '));
    } else {
      console.info('✅ Canon-Check: Alles konsistent.');
    }
  };
})();
</script>

  
<!-- 🔍 Suchbox Styles (unverändert) -->
<style>
  .searchbox{ margin:12px 0 20px; }
  .searchbox input{
    width:100%;
    padding:10px 14px;
    border:1.5px solid var(--border);
    border-radius: var(--radius-sm);
    font-size:14px;
    outline:none;
  }
  #searchResults{ list-style:none; margin:10px 0 0; padding:0; }
  #searchResults li{ margin:6px 0; }
  #searchResults a{
    display:block;
    padding:8px 10px;
    background:#fafafa;
    border:1px solid #eee;
    border-radius:var(--radius-sm);
    color:var(--text);
    text-decoration:none;
  }
</style>

<main class="page">

  <!-- ======= COVER (unverändert) ======= -->
  <section id="cover" class="category-cover" style="background-color:#F6F1E7; color:#333; min-height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; padding:20px;">
    <div style="border:3px dashed #e4dccb; padding:40px; border-radius:20px; text-align:center; max-width:90%; background:#fff;">
      <h1 style="font-size:2.2em; margin-bottom:20px; font-family:'Georgia','Times New Roman',serif;">
        Meine Lieblingsrezepte
      </h1>
      <div style="font-size:1.6em; margin-top:10px; color:#666;">🍽️</div>
    </div>
  </section>

  <!-- ======= INHALTSVERZEICHNIS ======= -->
  <section id="toc" class="toc beige">
    <div class="wrap">
      <h2>Inhaltsverzeichnis</h2>

      <!-- 🔍 Suchleiste -->
      <div class="searchbox">
        <input type="search" id="recipeSearch" placeholder="🔍 Rezept suchen..." />
        <ul id="searchResults"></ul>
      </div>

      <!-- Frühstück -->
      <div class="cat gelb" id="fruehstueck">
        <h3>🥐 Frühstück</h3>

        <h4>Brot & Aufstriche</h4>
        <ul id="fruehstueck-brot-aufstriche-list">
          <!-- leer – wird dynamisch gefüllt -->
        </ul>

        <h4>Sonstiges</h4>
        <ul id="fruehstueck-sonstiges-list">
          <!-- leer – wird dynamisch gefüllt -->
        </ul>

        <div><a class="pill" href="#cover">⬆️ Zurück zum Cover</a></div>
      </div>

      <div class="divider"></div>

      <!-- Hauptspeisen (bestehende Unterkategorien bleiben, Listen hier leer) -->
      <div class="cat mint" id="hauptspeisen">
        <h3>🥗 Hauptspeisen</h3>

        <h4>🍔 Burger, Wraps & Bowls</h4>
        <ul id="haupt-burger-wraps-bowls-list"></ul>

        <h4>🥦 Vegetarische Gerichte</h4>
        <ul id="haupt-vegetarisch-list"></ul> 
        
        <h4>🍲 Suppen & Eintöpfe</h4>
        <ul id="haupt-suppen-list"></ul>

        <h4>🍝 Pasta & Nudeln</h4>
        <ul></ul>

        <h4>🍕 Pizza</h4>
        <ul></ul>

        <h4>🍚 Reis- & Getreidegerichte</h4>
        <ul></ul>

        <h4>🌍 Internationale Küche & Currys</h4>
        <ul></ul>

        <h4>🥗 Snacks, Beilagen & Fingerfood</h4>
        <ul></ul>

        <h4>🥫 Basics & Saucen</h4>
        <ul></ul>

        <h4>🌶️ Curry-Pasten</h4>
        <ul></ul>

        <div><a class="pill" href="#cover">⬆️ Zurück zum Cover</a></div>
      </div>

      <div class="divider"></div>

      <!-- Bakery -->
      <div class="cat rosa" id="bakery">
        <h3>🍰 Bakery</h3>

        <h4>Kuchen & Torten</h4>
        <ul></ul>

        <h4>Plätzchen & Kleingebäck</h4>
        <ul></ul>

        <h4>Sonstiges Gebäck</h4>
        <ul></ul>

        <div><a class="pill" href="#cover">⬆️ Zurück zum Cover</a></div>
      </div>

      <div class="divider"></div>

      <!-- Snacks & Desserts -->
      <div class="cat orange" id="snacks">
        <h3>🍊 Snacks & Desserts</h3>
        <ul>
          <!-- leer – wird dynamisch gefüllt -->
        </ul>
        <div><a class="pill" href="#cover">⬆️ Zurück zum Cover</a></div>
      </div>

      <div class="divider"></div>

      <!-- Drinks mit Unterkategorien -->
      <div class="cat blau" id="drinks">
        <h3>🍹 Drinks</h3>

        <h4>Alkoholische Getränke</h4>
        <ul id="drinks-alkoholische-list">
          <!-- leer – wird dynamisch gefüllt -->
        </ul>

        <h4>Nicht-alkoholische Getränke</h4>
        <ul id="drinks-nicht-alkoholische-list">
          <!-- leer – wird dynamisch gefüllt -->
        </ul>

        <div><a class="pill" href="#cover">⬆️ Zurück zum Cover</a></div>
      </div>
    </div>
  </section>
</main>

<!-- ⭐ Nur-Rezepte-Suche (liest aktuelle TOC-Links) – unverändert -->
<script>
(function () {
  const input = document.getElementById('recipeSearch');
  const results = document.getElementById('searchResults');
  if (!input || !results) return;

  function collectItems(){
    const links = Array.from(document.querySelectorAll('.cat ul li a'));
    return links.map(a => ({ text: a.textContent.trim(), href: a.getAttribute('href') }));
  }

  const normalize = s => s.toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu, '');

  function render(list) {
    results.innerHTML = '';
    if (!list.length) { results.style.display = 'none'; return; }
    results.style.display = 'block';
    list.slice(0, 25).forEach(it => {
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = it.href;
      a.textContent = it.text;
      li.appendChild(a);
      results.appendChild(li);
    });
  }

  input.addEventListener('input', () => {
    const q = normalize(input.value || '');
    if (!q) { results.innerHTML=''; results.style.display='none'; return; }
    const items = collectItems();
    const matched = items.filter(it => normalize(it.text).includes(q));
    render(matched);
  });

  results.addEventListener('click', (e) => {
    if (e.target && e.target.tagName === 'A') {
      results.innerHTML = '';
      results.style.display = 'none';
    }
  });

  // Rebind-Helfer (unten, nach DB-Ladevorgang, wird rebuildSearch erneut aufgerufen)
  window.rebuildSearch && window.rebuildSearch();
})();
</script>

<!-- ======= QUICKJUMP (unten rechts) – unverändert ======= -->
<nav class="quickjump" aria-label="Schnellsprung">
  <a href="#toc">📖 Inhalt</a>
  <a href="#fruehstueck-cover">🥐 Frühstück</a>
  <a href="#hauptspeisen-cover">🥗 Hauptspeisen</a>
  <a href="#bakery-cover">🍰 Bakery</a>
  <a href="#snacks-cover">🍊 Snacks</a>
  <a href="#drinks-cover">🍹 Drinks</a>
</nav>



<!-- Frühstück-Cover -->
<section id="fruehstueck-cover" class="cover fruehstueck" 
         style="background:var(--gelb); min-height:70vh; display:flex; align-items:center; justify-content:center; text-align:center; padding:30px;">
  <div style="background:#fff; border:3px dashed #e6db95; border-radius:16px; padding:30px; max-width:92%; box-shadow:var(--shadow);">
    <h1 style="font-size:2em; margin:0;">🥐 Frühstück</h1>
    <p style="margin-top:10px; font-size:1em; color:var(--muted);">Starte lecker & gesund in den Tag.</p>
  </div>
</section>

<!-- =========================================================
     Frühstück – UNTERKATEGORIE-COVER
========================================================= -->
<section id="brot-und-aufstriche-cover" class="cover fruehstueck"
         style="background-color:#FFF6BF; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🥖 Brot & Aufstriche</h1>
</section>

<section id="fruehstueck-sonstiges-cover" class="cover fruehstueck"
         style="background-color:#FFF6BF; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">✨ Frühstück – Sonstiges</h1>
</section>


<!-- Hauptspeisen-Cover -->
<section id="hauptspeisen-cover" class="cover hauptspeisen" 
         style="background:var(--mint); min-height:70vh; display:flex; align-items:center; justify-content:center; text-align:center; padding:30px;">
  <div style="background:#fff; border:3px dashed #8fdac7; border-radius:16px; padding:30px; max-width:92%; box-shadow:var(--shadow);">
    <h1 style="font-size:2em; margin:0;">🥗 Hauptspeisen</h1>
    <p style="margin-top:10px; font-size:1em; color:var(--muted);">Vielfältig, nahrhaft & voller Genuss.</p>
  </div>
</section>


  <!-- =========================================================
     burger, wraps & bowls – UNTERKATEGORIE-COVER
========================================================= -->
<section id="burger-wraps-und-bowls-cover" class="cover hauptspeisen" 
         style="background-color:#CFF5E7; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🍔 Burger, Wraps & Bowls</h1>
</section>

<!-- =========================================================
     vegetarische gerichte – UNTERKATEGORIE-COVER
========================================================= -->
<section id="vegetarische-gerichte-cover" class="cover hauptspeisen" 
         style="background-color:#CFF5E7; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🥦 Vegetarische Gerichte</h1>
</section>

  
<!-- =========================================================
     suppen & eintöpfe – UNTERKATEGORIE-COVER
========================================================= -->
<section id="suppen-und-eintoepfe-cover" class="cover hauptspeisen" 
         style="background-color:#CFF5E7; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🍲 Suppen & Eintöpfe</h1>
</section>

<!-- =========================================================
     pasta & nudeln – UNTERKATEGORIE-COVER
========================================================= -->
<section id="pasta-und-nudeln-cover" class="cover hauptspeisen" 
         style="background-color:#CFF5E7; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🍝 Pasta & Nudeln</h1>
</section>

<!-- =========================================================
     pizza – UNTERKATEGORIE-COVER
========================================================= -->
<section id="pizza-cover" class="cover hauptspeisen" 
         style="background-color:#CFF5E7; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🍕 Pizza</h1>
</section>

<!-- =========================================================
     reis & getreide – UNTERKATEGORIE-COVER
========================================================= -->
<section id="reis-und-getreide-cover" class="cover hauptspeisen" 
         style="background-color:#CFF5E7; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🍚 Reis- & Getreidegerichte</h1>
</section>

<!-- =========================================================
     internationale küche & currys – UNTERKATEGORIE-COVER
========================================================= -->
<section id="internationale-kueche-und-currys-cover" class="cover hauptspeisen" 
         style="background-color:#CFF5E7; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🌍 Internationale Küche & Currys</h1>
</section>

  <!-- =========================================================
     snacks, beilagen & fingerfood – UNTERKATEGORIE-COVER
========================================================= -->
<section id="snacks-beilagen-und-fingerfood-cover" class="cover hauptspeisen" 
         style="background-color:#CFF5E7; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🥗 Snacks, Beilagen & Fingerfood</h1>
</section>

<!-- =========================================================
     basics & saucen – UNTERKATEGORIE-COVER
========================================================= -->
<section id="basics-und-saucen-cover" class="cover hauptspeisen" 
         style="background-color:#CFF5E7; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🥫 Basics & Saucen</h1>
</section>

<!-- =========================================================
     curry-pasten – UNTERKATEGORIE-COVER
========================================================= -->
<section id="curry-pasten-cover" class="cover hauptspeisen" 
         style="background-color:#CFF5E7; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🌶️ Curry-Pasten</h1>
</section>

  <!-- =========================================================
     Bakery-Cover
========================================================= -->
<section id="bakery-cover" class="cover bakery" 
         style="background:var(--rosa); min-height:70vh; display:flex; align-items:center; justify-content:center; text-align:center; padding:30px;">
  <div style="background:#fff; border:3px dashed #ff99cc; border-radius:16px; padding:30px; max-width:92%; box-shadow:var(--shadow);">
    <h1 style="font-size:2em; margin:0;">🍰 Bakery</h1>
    <p style="margin-top:10px; font-size:1em; color:var(--muted);">Süße Kuchen, feines Gebäck & mehr.</p>
  </div>
</section>


  <!-- =========================================================
     kuchen & torten – UNTERKATEGORIE-COVER (Bakery)
========================================================= -->
<section id="kuchen-und-torten-cover" class="cover bakery" 
         style="background-color:#FFD3E2; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🍰 Kuchen & Torten</h1>
</section>
  
<!-- =========================================================
     plätzchen & kleingebäck – UNTERKATEGORIE-COVER (Bakery)
========================================================= -->
<section id="plätzchen-und-kleingebäck-cover" class="cover bakery" 
         style="background-color:#FFD3E2; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🍪Plätzchen & Kleingebäck</h1>
</section>

  

  <!-- =========================================================
     Plätzchen & Kleingebäck: (vorhergehende Rezepte entfernt)
========================================================= -->

<!-- =========================================================
     sonstiges gebäck – UNTERKATEGORIE-COVER
========================================================= -->
<section id="sonstiges-gebäck-cover" class="cover bakery" 
         style="background-color:#FFD3E2; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🍮Sonstiges Gebäck</h1>
</section>



<!-- =========================================================
     Snacks & Desserts (Cover) – (alle Rezepte entfernt)
========================================================= -->
<section id="snacks-cover" class="cover snacks" 
         style="background:var(--orange); min-height:70vh; display:flex; align-items:center; justify-content:center; text-align:center; padding:30px;">
  <div style="background:#fff; border:3px dashed #ffb266; border-radius:16px; padding:30px; max-width:92%; box-shadow:var(--shadow);">
    <h1 style="font-size:2em; margin:0;">🍊 Snacks & Desserts</h1>
    <p style="margin-top:10px; font-size:1em; color:var(--muted);">Kleine Sünden für zwischendurch.</p>
  </div>
</section>



<!-- =========================================================
     Drinks (Cover) – neue Unterkategorien hinzugefügt
========================================================= -->
<section id="drinks-cover" class="cover drinks" 
         style="background:var(--blau); min-height:70vh; display:flex; align-items:center; justify-content:center; text-align:center; padding:30px;">
  <div style="background:#fff; border:3px dashed #99cfff; border-radius:16px; padding:30px; max-width:92%; box-shadow:var(--shadow);">
    <h1 style="font-size:2em; margin:0;">🍹 Drinks</h1>
    <p style="margin-top:10px; font-size:1em; color:var(--muted);">Erfrischend, bunt & manchmal ein bisschen frech.</p>
  </div>
</section>

<!-- Drinks – UNTERKATEGORIE-COVER: Alkoholische Getränke -->
<section id="alkoholische-getraenke-cover" class="cover drinks"
         style="background-color:#CFE9FF; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🍸 Alkoholische Getränke</h1>
</section>

<!-- Drinks – UNTERKATEGORIE-COVER: Alkoholfreie Getränke -->
<section id="alkoholfreie-getraenke-cover" class="cover drinks"
         style="background-color:#CFE9FF; padding:60px 20px; text-align:center; border-radius:18px; margin:20px 0;">
  <h1 style="font-size:2em; margin:0;">🥤 Alkoholfreie Getränke</h1>
</section>

  
  




<script>
/* === Alle Rezept-Sektionen je (Kategorie, Unterkategorie) alphabetisch sortieren === */
(function(){
  const norm = s => (s||'').toLowerCase()
    .normalize('NFD').replace(/\p{Diacritic}/gu,'').trim();

  function resortGroup(cat, sub){
    const sel = Array.from(document.querySelectorAll('section.recipe'))
      .filter(s => (s.dataset.category||'') === (cat||'')
                && (s.dataset.subcategory||'') === (sub||''));
    if (sel.length < 2) return;

    sel.sort((a,b)=>{
      const A = norm(a.querySelector('h2')?.textContent);
      const B = norm(b.querySelector('h2')?.textContent);
      return A.localeCompare(B);
    });

    // Anker hinter dem passenden Cover finden
    const t = (typeof resolveTargets==='function') ? resolveTargets(cat, sub) : {};
    const anchor = t?.contentAnchor ||
      document.querySelector('#' + (cat||'').toLowerCase() + '-cover') ||
      document.querySelector('#cover') || document.body;

    // in richtiger Reihenfolge direkt nach dem Cover platzieren
    let ref = anchor;
    sel.forEach(sec => { ref.insertAdjacentElement('afterend', sec); ref = sec; });

    // Sicherheitsnetz: richtige Farbklasse forcieren
    sel.forEach(sec=>{
      sec.classList.remove('fruehstueck','hauptspeisen','bakery','snacks','drinks');
      if (cat === 'Frühstück') sec.classList.add('fruehstueck');
      else if (cat === 'Hauptspeise') sec.classList.add('hauptspeisen');
      else if (cat === 'Bakery') sec.classList.add('bakery');
      else if (cat === 'Snacks & Desserts') sec.classList.add('snacks');
      else if (cat === 'Drinks') sec.classList.add('drinks');
    });
  }

  window.sortAllSections = function(){
    // alle (Kategorie, Unterkategorie)-Paare durchgehen
    const pairs = new Set();
    document.querySelectorAll('section.recipe').forEach(sec=>{
      pairs.add(JSON.stringify({cat: sec.dataset.category||'', sub: sec.dataset.subcategory||''}));
    });
    pairs.forEach(str=>{
      const {cat, sub} = JSON.parse(str);
      resortGroup(cat, sub);
    });
  };

  // für punktuelles Nachsortieren nach dem Einfügen
  window.resortGroupFor = function(section){
    if (!section) return;
    resortGroup(section.dataset.category||'', section.dataset.subcategory||'');
  };
})();
</script>

  


<script>
/* === FIX 1: Modal öffnen/schließen + Kategorien/Subkategorien füllen === */
(function(){
  const $ = (sel, root=document) => root.querySelector(sel);
  const modal    = $('#addRecipeModal');
  const openBtn  = $('#openAddRecipe');
  const cancel   = $('#cancelAdd');
  const catSel   = $('#category');
  const subSel   = $('#subcategory');

  function open(e){ if(e) e.preventDefault(); if(modal) modal.style.display = 'flex'; }
  function close(){ if(modal) modal.style.display = 'none'; }

  openBtn?.addEventListener('click', open);
  cancel?.addEventListener('click', close);
  modal?.addEventListener('click', (e)=>{ if(e.target === modal) close(); });
  document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && modal?.style.display === 'flex') close(); });

  function fillCats(){
    if(!catSel) return;
    const cats = Object.keys(window.CATS || {});
    catSel.innerHTML =
      `<option value="" disabled selected>Bitte wählen…</option>` +
      cats.map(c => `<option>${c}</option>`).join('');
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', fillCats);
  } else {
    fillCats();
  }

  catSel?.addEventListener('change', ()=>{
    const subs = (window.CATS || {})[catSel.value] || [];
    subSel.innerHTML = '';
    subSel.disabled  = !subs.length;
    subSel.required  = subs.length > 0;

    if (!subs.length) return;
    subSel.innerHTML =
      `<option value="" disabled selected>Unterkategorie wählen…</option>` +
      subs.map(s => `<option>${s}</option>`).join('');
  });
})();
</script>

<script>
/* === FIX 2: buildRecipeSection – Rezeptkarte generieren === */
window.buildRecipeSection = function({
  id, title, servings, prep, total, ingredients, steps, cat, sub, dbId
}){
  const ingLis = (ingredients||[]).map(line=>{
    if (typeof line === 'string') {
      const m = line.trim().match(/^(\d+(?:[.,]\d+)?)\s+(.*)$/);
      if (m) {
        const val = m[1].replace(',','.');
        return `<li><span data-base="${val}">${val}</span> ${m[2]}</li>`;
      }
      return `<li>${line.trim()}</li>`;
    }
    return '';
  }).join('');

  const stepsOl = (steps||[]).map(s=>`<li>${(typeof s==='string'?s:s?.text||'').trim()}</li>`).join('');

  const catClass =
    cat === "Frühstück"          ? "fruehstueck"  :
    cat === "Hauptspeise"        ? "hauptspeisen" :
    cat === "Bakery"             ? "bakery"       :
    cat === "Snacks & Desserts"  ? "snacks"       :
    cat === "Drinks"             ? "drinks"       : "";

  return `
<section id="${id}" class="recipe ${catClass}"
         data-recipe-id="${dbId || id}"
         data-category="${cat || ''}"
         data-subcategory="${sub || ''}">
  <div style="display:flex; gap:8px; justify-content:flex-end; margin-bottom:6px;">
    <button class="btn btn-edit" data-id="${dbId || id}" style="padding:6px 10px;">✏️ Bearbeiten</button>
    <button class="btn btn-delete" data-id="${dbId || id}" style="padding:6px 10px;">🗑️ Löschen</button>
  </div>

  <h2>${title}</h2>
  <p class="meta">
    ⏱️ Zubereitungszeit: ${prep} | 🕒 Gesamtzeit: ${total} | 👥 Portionen:
    <input type="number" value="${servings}" min="1" style="width:60px"
           oninput="window.updateRecipe && window.updateRecipe()"
           onchange="window.updateRecipe && window.updateRecipe()">
  </p>

  <div class="zutaten">
    <h3>🥕 Zutaten</h3>
    <ul id="${id}-zutaten">
      ${ingLis}
    </ul>
  </div>

  <div class="zubereitung">
    <h3>👩‍🍳 Zubereitung</h3>
    <ol>
      ${stepsOl}
    </ol>
  </div>
</section>`;
};
</script>
  
  
  <script>
/* ===== DB -> Frontend: Alles laden und ins DOM setzen (gefixt) ===== */
(function(){
  async function renderRecipeRecord(rec){
    const id = rec.id;
    const title = rec.title;
    const cat = rec.category;
    const sub = rec.subcategory || '';
    const servings = rec.servings;
    const prep = rec.prep;
    const total = rec.total;
    const ingredients = JSON.parse(rec.ingredients_json || '[]');
    const steps = JSON.parse(rec.steps_json || '[]');
    
    if(!window.buildRecipeSection){ console.warn('buildRecipeSection fehlt'); return; }

    const html = buildRecipeSection({
      id, title, servings, prep, total, ingredients, steps, cat, sub, dbId: rec.id
    });

    const t = document.createElement('template');
    t.innerHTML = html.trim();
    const section = t.content.firstElementChild;

// erstmal nur anhängen – alphabetisch sortiert wird global
// Section **richtig** einsortieren (unter passendes Cover, alphabetisch)
if (typeof insertSortedSection === 'function') {
  insertSortedSection({ section, cat, sub });
} else {
  const targets = (typeof resolveTargets === 'function') ? resolveTargets(cat, sub) : {};
  (targets?.contentAnchor || document.getElementById('cover') || document.body)
    .insertAdjacentElement('afterend', section);
}
    

    if (window.initRecipeScaling) window.initRecipeScaling();

    // Richtige TOC-Liste per getTocList
    const tocList = (window.getTocList ? getTocList(cat, sub) : (window.resolveTargets?.(cat, sub)||{}).tocList);
    if (tocList && !tocList.querySelector(`a[href="#${id}"]`)) {
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = '#' + id;
      a.textContent = title;
      li.appendChild(a);
      if (typeof insertSortedTOC === 'function') insertSortedTOC(tocList, li);
      else tocList.appendChild(li);
    }
  }

  async function loadAllRecipes(){
    try{
      const res = await fetch('/api/recipes', { headers:{accept:'application/json'} });
      if(!res.ok) throw new Error('GET /api/recipes fehlgeschlagen');
      const list = await res.json();
      for(const rec of list) await renderRecipeRecord(rec);

      if (window.rebuildSearch) window.rebuildSearch();
      if (window.initRecipeScaling) window.initRecipeScaling();
      if (window.sortExistingTOCLists) window.sortExistingTOCLists();
      if (window.sortAllSections) window.sortAllSections();
    }catch(e){
      console.error('Rezepte laden fehlgeschlagen:', e);
    }
  }

  if(document.readyState==='loading'){
    document.addEventListener('DOMContentLoaded', loadAllRecipes);
  } else {
    loadAllRecipes();
  }
})();
</script>

  
<script>
/* ========= 1) Portionsrechner ========= */
(function(){
  function num(v){ if(v==null) return null; const n=parseFloat(String(v).replace(',','.')); return isNaN(n)?null:n; }
  function fmt(x){ return (x>=1 || Math.abs(x-Math.round(x))<1e-9) ? String(Math.round(x)) : String(Math.round(x*10)/10); }

  function bindSection(sec){
    const input = sec.querySelector('.meta input[type="number"]');
    if(!input) return;

    const baseServings = parseFloat(input.getAttribute('value') || input.value || '1') || 1;
    sec.dataset.baseServings = String(baseServings);

    sec.querySelectorAll('[data-base]').forEach(s=>{
      if(!s.dataset.orig){
        const o = num(s.getAttribute('data-base'));
        if(o!=null) s.dataset.orig = String(o);
      }
    });

    const update = ()=>{
      const desired = Math.max(1, parseFloat(input.value || '1') || 1);
      const f = desired / (parseFloat(sec.dataset.baseServings||'1') || 1);
      sec.querySelectorAll('[data-base]').forEach(s=>{
        const o = num(s.dataset.orig); if(o==null) return;
        s.textContent = fmt(o * f);
      });
    };

    input.addEventListener('input', update);
    input.addEventListener('change', update);
    update();
  }

  window.initRecipeScaling = function(){
    document.querySelectorAll('section.recipe').forEach(bindSection);
  };

  window.updateRecipe = function(){
    const sec = event?.target ? event.target.closest('section.recipe') : null;
    if(sec) bindSection(sec);
  };

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ()=>window.initRecipeScaling());
  } else {
    window.initRecipeScaling();
  }
})();
</script>

<script>
/* ========= 2) TOC-Helfer ========= */
(function(){
  window.addToTOC = function({title, id, cat, sub}){
    let ul = null;

    if (typeof resolveTargets === 'function') {
      try {
        const t = resolveTargets(cat, sub);
        ul = t?.tocList || null;
      } catch {}
    }

    if(!ul){
      const catId =
        cat === 'Bakery' ? '#bakery' :
        cat === 'Drinks' ? '#drinks' :
        (cat && cat.toLowerCase().includes('haupt')) ? '#hauptspeisen' :
        (cat && cat.toLowerCase().includes('snacks')) ? '#snacks' :
        (cat && (cat.toLowerCase().includes('früh') || cat.toLowerCase().includes('frueh'))) ? '#fruehstueck' :
        null;

      const root = catId ? document.querySelector(catId) : document;
      ul = root?.querySelector('.cat ul') || root?.querySelector('ul') || document.querySelector('.cat ul');
    }

    if(!ul) return;

    const li = document.createElement('li');
    const a  = document.createElement('a');
    a.href = '#' + id;
    a.textContent = title;
    li.appendChild(a);

    if (typeof insertSortedTOC === 'function') {
      insertSortedTOC(ul, li);
    } else {
      ul.appendChild(li);
    }
  };
})();
</script>



  <script>
/* ========= Modal: Editieren/Löschen + Submit (TOC-Fix enthalten) ========= */
(function(){
  const modal = document.getElementById('addRecipeModal');
  const form  = document.getElementById('recipeForm');
  const catSelect = document.getElementById('category');
  const subSelect = document.getElementById('subcategory');

  window.__editingRecipeId = null;

  function openModal(){ modal.style.display = 'flex'; }
  function closeModal(){ modal.style.display = 'none'; window.__editingRecipeId = null; }

  document.addEventListener('click', async (e)=>{
    const btn = e.target.closest('button');
    if(!btn) return;

    // Löschen (siehe separater Delete-Block unten für robustere Variante)
    

    if (btn.classList.contains('btn-edit')) {
      const sec = btn.closest('section.recipe');
      const dbId = btn.dataset.id;
      if (!sec || !dbId) return;

      window.__editingRecipeId = dbId;

      const title = sec.querySelector('h2')?.textContent.trim() || '';
      const servings = parseInt(sec.querySelector('.meta input[type=number]')?.value || '1', 10) || 1;
      const cat = sec.dataset.category || '';
      const sub = sec.dataset.subcategory || '';

      const ings = Array.from(sec.querySelectorAll('.zutaten li')).map(li=>{
        const span = li.querySelector('[data-base]');
        if (span) {
          const base = span.getAttribute('data-base') || span.dataset.orig || span.textContent.trim();
          const rest = li.textContent.replace(span.textContent,'').trim();
          return `${base} ${rest}`;
        }
        return li.textContent.trim();
      });

      const steps = Array.from(sec.querySelectorAll('.zubereitung ol li')).map(li=>li.textContent.trim());

      document.getElementById('title').value = title;
      document.getElementById('servings').value = String(servings);
      document.getElementById('prep').value =
        (sec.querySelector('.meta')?.textContent.match(/Zubereitungszeit:\s*([^|]+)/)?.[1] || '').trim();
      document.getElementById('total').value =
        (sec.querySelector('.meta')?.textContent.match(/Gesamtzeit:\s*([^|]+)/)?.[1] || '').trim();
      document.getElementById('ingredients').value = ings.join('\n');
      document.getElementById('steps').value = steps.join('\n');

      if (cat) {
        catSelect.value = cat;
        catSelect.dispatchEvent(new Event('change'));
        if (sub) subSelect.value = sub;
      }

      openModal();
      return;
    }
  });

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();

    const title = document.getElementById('title').value.trim();
    const category = catSelect.value;
    const subcategory = (subSelect.value || '').trim();
    const servings = Math.max(1, parseInt(document.getElementById('servings').value || '1', 10));
    const prep = document.getElementById('prep').value.trim();
    const total = document.getElementById('total').value.trim();
    const ingredients = (document.getElementById('ingredients').value || '').split('\n').map(s=>s.trim()).filter(Boolean);
    const steps = (document.getElementById('steps').value || '').split('\n').map(s=>s.trim()).filter(Boolean);

    if (!title || !category || !prep || !total || !ingredients.length || !steps.length) {
      alert('Bitte alle Pflichtfelder ausfüllen.'); return;
    }

if (window.__editingRecipeId) {
  // 1) Backend aktualisieren
  const res = await fetch('/api/recipes?id=' + encodeURIComponent(window.__editingRecipeId), {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ title, category, subcategory, servings, prep, total, ingredients, steps })
  });
  if (!res.ok) { alert('Speichern fehlgeschlagen'); return; }

  // kleine Hilfsfunktion für DOM-IDs
  const makeSlug = (s) => (s || '')
    .toLowerCase()
    .normalize('NFD').replace(/\p{Diacritic}/gu,'')
    .replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'')
    .slice(0,64) || 'rezept';

  // 2) Alte Section + TOC-Eintrag(e) entfernen
  const oldSec = document.querySelector(`section.recipe[data-recipe-id="${window.__editingRecipeId}"]`);
  if (oldSec) {
    const oldHash = '#' + oldSec.id;
    oldSec.remove();
    document.querySelectorAll(`.cat ul li a[href="${oldHash}"]`).forEach(a => a.parentElement?.remove());
  }

  // 3) Neue Section bauen (ID an den Titel koppeln, + DB-ID für Eindeutigkeit)
  let domId = makeSlug(title) + '-' + window.__editingRecipeId;
  // falls (sehr unwahrscheinlich) schon vorhanden -> laufende Nummer
  let n = 2;
  while (document.getElementById(domId)) domId = makeSlug(title) + '-' + window.__editingRecipeId + '-' + (n++);

  const targets = (typeof resolveTargets === 'function') ? resolveTargets(category, subcategory) : {};
  const contentAnchor = targets?.contentAnchor || document.body;

  const html = buildRecipeSection({
    id: domId,
    title, servings, prep, total,
    ingredients, steps,
    cat: category, sub: subcategory,
    dbId: window.__editingRecipeId
  });
  const t = document.createElement('template');
  t.innerHTML = html.trim();
  const section = t.content.firstElementChild;

  // 4) Section korrekt einsortieren (unter richtiges Cover, alphabetisch)
  if (typeof insertSortedSection === 'function') {
    insertSortedSection({ section, cat: category, sub: subcategory });
  } else {
    contentAnchor.insertAdjacentElement('afterend', section);
  }

  // 5) TOC-Eintrag in die richtige Liste, alphabetisch
  const tocList = (window.getTocList ? getTocList(category, subcategory)
                                     : (targets?.tocList || document.querySelector('.cat ul')));
  if (tocList) {
    const li = document.createElement('li');
    const a  = document.createElement('a');
    a.href = '#' + domId;
    a.textContent = title;
    li.appendChild(a);
    if (typeof insertSortedTOC === 'function') insertSortedTOC(tocList, li);
    else tocList.appendChild(li);
  }

  // 6) Helfer reaktivieren + in der Gruppe sicherheitshalber alphabetisch sortieren
  if (window.initRecipeScaling) window.initRecipeScaling();
  if (window.resortGroupFor)    window.resortGroupFor(section);
  if (window.rebuildSearch)     window.rebuildSearch();

  closeModal();
  setTimeout(() => { location.hash = '#' + domId; }, 50);
  return;
}
    const res = await fetch('/api/recipes', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ title, category, subcategory, servings, prep, total, ingredients, steps })
    });
    if (!res.ok) { alert('Speichern fehlgeschlagen'); return; }
    const data = await res.json();

    const slug = (s) => s.toLowerCase()
      .normalize('NFD').replace(/\p{Diacritic}/gu,'')
      .replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'')
      .slice(0,64) || 'rezept';
    let domId = slug(title);
    let i=2; while(document.getElementById(domId)) domId = slug(title) + '-' + (i++);

    const targets = (typeof resolveTargets === 'function') ? resolveTargets(category, subcategory) : {};
    const contentAnchor = targets?.contentAnchor || document.body;

    const html = buildRecipeSection({
      id: domId,
      title, servings, prep, total,
      ingredients, steps,
      cat: category, sub: subcategory,
      dbId: data.id
    });
    const t = document.createElement('template');
    t.innerHTML = html.trim();
    const section = t.content.firstElementChild;

    if (typeof insertSortedSection === 'function') {
      insertSortedSection({ section, cat: category, sub: subcategory });
    } else {
      contentAnchor.insertAdjacentElement('afterend', section);
    }

    if (typeof window.initRecipeScaling === 'function') window.initRecipeScaling();

    // >>> WICHTIG: TOC-Liste korrekt bestimmen
    const tocList = (window.getTocList ? getTocList(category, subcategory) : (targets?.tocList || document.querySelector('.cat ul')));
    if (tocList) {
      const li = document.createElement('li');
      const a = document.createElement('a'); a.href = '#' + domId; a.textContent = title;
      li.appendChild(a);
      if (typeof insertSortedTOC === 'function') insertSortedTOC(tocList, li);
      else tocList.appendChild(li);
    }

    if (typeof rebuildSearch === 'function') rebuildSearch();
if (window.resortGroupFor) window.resortGroupFor(section);
    closeModal();
    setTimeout(()=>{ location.hash = '#' + domId; }, 50);
  });
})();
</script>

  


  
<script>
/* ===== Delete-Logik: Rezept + TOC-Link(e) entfernen ===== */
(function(){
  document.addEventListener('click', async (e)=>{
    const btn = e.target.closest('button.btn-delete');
    if (!btn) return;

    const dbId = btn.dataset.id;
    if (!dbId) return;

    if (!confirm('Dieses Rezept wirklich löschen?')) return;

    try{
      const res = await fetch('/api/recipes?id=' + encodeURIComponent(dbId), { method:'DELETE' });
      if(!res.ok){ alert('Löschen fehlgeschlagen'); return; }
    }catch(err){
      alert('Netzwerkfehler beim Löschen'); return;
    }

    const sec = btn.closest('section.recipe');
    if (sec) {
      const hash = '#' + sec.id;
      sec.remove();
      document.querySelectorAll(`.cat ul li a[href="${hash}"]`).forEach(a=>{
        const li = a.parentElement;
        if (li) li.remove();
      });
      if (window.rebuildSearch) window.rebuildSearch();
      if (window.sortExistingTOCLists) window.sortExistingTOCLists();
    }
  });
})();
</script>
  




<script>
/* Client-only Fallback: /api/recipes in localStorage emulieren (robust für file://) */
(function(){
  const nativeFetch = window.fetch.bind(window);
  const KEY = 'recipes';

  function json(data, status=200){
    return new Response(JSON.stringify(data), {
      status, headers:{'Content-Type':'application/json'}
    });
  }

  // Hilfen ohne URL()
  function getQuery(href){
    const q = href.split('?')[1] || '';
    return new URLSearchParams(q);
  }

  window.fetch = async function(resource, options={}){
    const isReq = typeof Request !== 'undefined' && resource instanceof Request;
    const urlStr = isReq ? resource.url : String(resource || '');
    // sowohl '/api/recipes' als auch absolute Variationen abfangen
    if (!/\/api\/recipes(\b|\/|\?)/.test(urlStr)) {
      return nativeFetch(resource, options);
    }

    const method = (options.method || (isReq ? resource.method : 'GET') || 'GET').toUpperCase();
    const qs = getQuery(urlStr);
    const id = qs.get('id');
    let db = JSON.parse(localStorage.getItem(KEY) || '[]');

    try{
      if (method === 'GET') {
        return json(db);
      }

      // Body holen (auch wenn fetch mit Request kommt)
      const rawBody = options.body || (isReq ? await resource.clone().text() : '');
      const body = rawBody ? JSON.parse(rawBody) : {};

      if (method === 'POST') {
        const newId = String(Date.now());
        const rec = {
          id: newId,
          title: body.title,
          category: body.category,
          subcategory: body.subcategory,
          servings: body.servings,
          prep: body.prep,
          total: body.total,
          ingredients_json: JSON.stringify(body.ingredients || []),
          steps_json: JSON.stringify(body.steps || [])
        };
        db.push(rec);
        localStorage.setItem(KEY, JSON.stringify(db));
        return json({ id: newId });
      }

      if (method === 'PUT' && id) {
        db = db.map(r => r.id === id ? {
          ...r,
          title: body.title,
          category: body.category,
          subcategory: body.subcategory,
          servings: body.servings,
          prep: body.prep,
          total: body.total,
          ingredients_json: JSON.stringify(body.ingredients || []),
          steps_json: JSON.stringify(body.steps || [])
        } : r);
        localStorage.setItem(KEY, JSON.stringify(db));
        return json({ ok: true });
      }

      if (method === 'DELETE' && id) {
        db = db.filter(r => r.id !== id);
        localStorage.setItem(KEY, JSON.stringify(db));
        return json({ ok: true });
      }

      return json({ error:'not-found' }, 404);
    }catch(e){
      console.error('LocalStorage-API-Fehler:', e);
      return json({ error:'client-fallback-error' }, 500);
    }
  };
})();
</script>

</body>
</html>


  


